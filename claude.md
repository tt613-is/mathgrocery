# Math Grocery - 数学杂货店游戏

## 🎮 项目简介

一个帮助练习心算的网页小游戏。玩家扮演杂货店老板，需要快速计算找零金额，提升数学计算能力。

**核心玩法：**
- 玩家点击货架选择商品
- 将商品添加到购物车
- 确认订单后系统生成顾客支付金额
- 玩家计算并输入找零
- 系统判断对错并显示顾客反馈

## 🚀 快速开始

直接用浏览器打开 `index.html` 即可开始游戏。

## ✨ 当前功能（v0.2.0）

- [x] 商品货架展示（11种商品，网格布局）
- [x] 点击选择商品添加到购物车
- [x] 购物车管理（添加/移除商品）
- [x] 确认订单生成顾客支付金额
- [x] 玩家输入找零金额
- [x] 对错判断和表情反馈（😊/😡）
- [x] "再来一单"继续游戏
- [x] 支持小数价格（保留2位小数）
- [x] 响应式设计（移动端和桌面端）

## 🛠 技术栈

- **纯 HTML/CSS/JavaScript** - 无框架依赖
- **单文件架构** - 所有代码在 index.html 中
- **响应式设计** - 适配移动端和桌面端

## 📝 开发决策记录

### 2025-01-02 - 项目初始化

**为什么选择单文件架构？**
- 便于部署：双击即可运行，无需服务器
- 降低复杂度：MVP阶段无需构建工具
- 易于分享：单个HTML文件即可传播

**为什么使用小数价格？**
- 更贴近真实购物场景
- 增加计算难度和趣味性
- 使用toFixed(2)处理浮点数精度问题

**商品定价策略：**
- 价格范围：$0.5-$56.3
- 甜甜圈有A/B/C三种型号，价格不同
- 支持小数点后最多2位
- 顾客支付金额 = 总价 + 随机(1-5)美元，保证有找零

### 2025-01-02 - 价格系统更新

**更新商品库：**
- 从6种商品扩展到11种商品
- 新增鸡腿商品
- 甜甜圈分为A/B/C三种型号，增加多样性

**支持小数价格：**
- 棒棒糖 $0.5（MVP阶段暂不支持数量优惠）
- 甜甜圈A/B/C分别为 $2/$2.5/$2.7
- 薯片 $1.2
- 肉/鱼/鸡腿 $56.3（高价商品增加难度）

**浮点数精度处理：**
- 所有价格计算使用 `toFixed(2)` 保留两位小数
- 比较答案时也使用 `toFixed(2)` 避免精度问题
- 确保显示和计算的一致性

### 2025-01-02 - 游戏玩法重构

**为什么重新设计游戏玩法？**
- 参考手绘设计图，增强玩家互动性
- 让玩家主动选择商品，而非被动接受订单
- 更接近真实购物和收银场景

**新的游戏流程：**
1. 阶段1：玩家浏览货架，点击选择商品
2. 阶段2：管理购物车（可添加/移除）
3. 阶段3：确认订单，系统生成顾客支付金额
4. 阶段4：计算并输入找零
5. 阶段5：查看结果反馈

**UI/UX优化：**
- 网格布局展示所有商品（响应式）
- 悬停效果提示可点击
- 购物车实时显示已选商品
- 清晰的分阶段操作流程
- 购物车可随时移除商品

**技术实现：**
- 游戏状态管理（phase: selecting/checkout/result）
- 购物车数据结构
- 分阶段UI显示/隐藏控制

## 🎯 代码结构

### 核心数据
```javascript
// 商品库（带ID标识）
products = [
  { id: 'apple', name: "苹果", emoji: "🍎", price: 3 },
  { id: 'donut_a', name: "甜甜圈A", emoji: "🍩", price: 2 },
  // ...
]

// 游戏状态管理
gameState = {
  phase: 'selecting', // selecting, checkout, result
  cart: [],           // 购物车商品数组
  total: 0,           // 总价
  customerPaid: 0,    // 顾客支付金额
  correctChange: 0    // 正确找零
}
```

### 核心函数
- `initShelf()` - 初始化商品货架
- `addToCart(product)` - 添加商品到购物车
- `removeFromCart(index)` - 从购物车移除商品
- `updateCart()` - 更新购物车显示
- `confirmOrder()` - 确认订单并生成支付金额
- `checkAnswer()` - 验证找零是否正确
- `nextRound()` - 开始下一轮游戏

## 🗺 后续迭代计划

### v0.3.0 - 游戏性增强
- [ ] 计分系统（连续答对次数）
- [ ] 倒计时功能（增加紧张感）
- [ ] 棒棒糖数量优惠（1个$0.5，2个$0.7）

### v0.4.0 - 难度系统
- [ ] 简单模式：整数价格，2个商品
- [ ] 普通模式：整数价格，3-4个商品
- [ ] 困难模式：小数价格，4-5个商品

### v0.4.0 - 用户体验
- [ ] 本地存储最高分
- [ ] 动画效果优化
- [ ] 音效反馈

### 未来想法
- [ ] 多人对战模式
- [ ] 每日挑战
- [ ] 成就系统

## 🤖 AI 协作提示

**给 Claude 的上下文：**
- 这是一个单人开发的教育小游戏项目
- 所有代码在 `index.html` 中
- 文档策略：claude.md 替代 README（同时服务于用户和AI）
- Git 工作流：功能完成后统一提交

**开发原则：**
- MVP 优先，功能极简
- 代码清晰，注释完整
- 每次提交都更新文档

**当前待办事项：**
查看 todo list 了解当前任务进度

## 📚 参考资源

- [JavaScript 浮点数精度问题](https://0.30000000000000004.com/)
- [Keep a Changelog](https://keepachangelog.com/)

## 📄 许可

个人学习项目，欢迎参考和使用。
